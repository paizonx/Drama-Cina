<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drachin - Nonton Drama Gratis</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* === STYLE YOUTUBE DARK (Tetap Sama) === */
        :root { --bg-dark: #0f0f0f; --text-main: #fff; --red: #ff0000; }
        body { margin: 0; font-family: 'Roboto', sans-serif; background-color: var(--bg-dark); color: var(--text-main); overflow-x: hidden; }
        a { text-decoration: none; color: inherit; }
        
        .navbar { display: flex; align-items: center; justify-content: space-between; padding: 0 15px; height: 56px; background: #0f0f0f; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #2a2a2a; }
        .logo { font-size: 20px; font-weight: bold; display: flex; align-items: center; gap: 4px; }
        .logo span { color: var(--red); font-size: 24px; }
        .nav-right a { font-size: 14px; font-weight: 500; margin-left: 10px; cursor: pointer; }
        .btn-vip { background: var(--red); padding: 8px 14px; border-radius: 20px; color: white; }

        .main-container { max-width: 1280px; margin: 0 auto; padding: 15px; min-height: 80vh; }

        /* GALERI */
        #galleryView { display: block; }
        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 10px; row-gap: 20px; }
        @media(min-width: 600px) { .video-grid { grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 16px; } }

        .video-card { cursor: pointer; transition: transform 0.2s; display: flex; flex-direction: column; }
        .thumb-box { position: relative; width: 100%; aspect-ratio: 16/9; background: #222; border-radius: 10px; overflow: hidden; }
        .thumb-img { width: 100%; height: 100%; object-fit: cover; }
        .duration { position: absolute; bottom: 6px; right: 6px; background: rgba(0,0,0,0.8); color: #fff; padding: 2px 4px; border-radius: 4px; font-size: 11px; }
        
        .vid-info { margin-top: 10px; display: flex; gap: 10px; }
        .avatar { width: 36px; height: 36px; border-radius: 50%; background: #333; flex-shrink: 0; overflow: hidden; }
        .meta-text { display: flex; flex-direction: column; width: 100%; }
        .vid-title { font-size: 14px; font-weight: 500; line-height: 1.3; margin-bottom: 4px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; color: #f1f1f1; }
        .vid-chan { font-size: 12px; color: #aaa; }

        /* PLAYER VIEW */
        #playerView { display: none; }
        .player-layout { display: grid; grid-template-columns: 1fr; gap: 24px; }
        @media (min-width: 1000px) { .player-layout { grid-template-columns: 2.5fr 1fr; } } 

        .player-box { background: #000; width: 100%; border-radius: 12px; overflow: hidden; position: relative; aspect-ratio: 16/9; }
        .player-box.vertical { aspect-ratio: 9/16; max-width: 400px; margin: 0 auto; }
        
        iframe, video { width: 100%; height: 100%; border: none; }

        .watch-title { font-size: 18px; font-weight: 700; margin: 15px 0 10px 0; line-height: 1.3; }
        .watch-actions { display: flex; gap: 10px; border-bottom: 1px solid #2a2a2a; padding-bottom: 15px; margin-bottom: 15px; overflow-x: auto; }
        .btn-action { background: #272727; color: white; border: none; padding: 8px 16px; border-radius: 18px; cursor: pointer; font-size: 14px; font-weight: 500; white-space: nowrap; }
        .btn-download { background: #fff; color: #000; font-weight: bold; }
        
        .ad-box { background: #1a1a1a; padding: 10px; margin-bottom: 20px; border-radius: 8px; text-align: center; font-size: 12px; color: #555; }
        .back-nav { display: flex; align-items: center; color: #aaa; margin-bottom: 15px; cursor: pointer; font-size: 14px; }
    </style>

    <script type="text/javascript" src="https://ridernoodleacerbity.com/c9/c0/46/c9c04611f8fb3b0b21da4b49fb98d3fa.js"></script>
</head>
<body>

    <nav class="navbar">
        <a href="?" class="logo"><span>‚ñ∂</span> Drachin</a>
        <div class="nav-right">
            <a href="https://ridernoodleacerbity.com/pu4v8n14t?key=280fea026bf240b90dd4b3343468c40f" target="_blank">Upload</a>
            <a href="https://ridernoodleacerbity.com/pu4v8n14t?key=280fea026bf240b90dd4b3343468c40f" target="_blank" class="btn-vip">Get App</a>
        </div>
    </nav>

    <div class="main-container">

        <div id="galleryView">
            <div class="ad-box">
                <script async="async" data-cfasync="false" src="https://ridernoodleacerbity.com/8754c34f20e587c8ef08a064d9f71e59/invoke.js"></script>
                <div id="container-8754c34f20e587c8ef08a064d9f71e59"></div>
            </div>
            <div id="statusMsg" style="text-align:center; color:#555; margin-top:50px;">Memuat Video...</div>
            <div class="video-grid" id="gridTarget"></div>
        </div>

        <div id="playerView">
            <div onclick="goHome()" class="back-nav">‚Üê Kembali ke Galeri</div>

            <div class="player-layout">
                <div>
                    <div id="playerShell" class="player-box">
                        <iframe id="iframePlayer" allow="autoplay; fullscreen" allowfullscreen style="display:none;"></iframe>
                        <video id="videoPlayer" controls playsinline style="display:none;"></video>
                    </div>

                    <h1 id="vidTitle" class="watch-title">...</h1>
                    
                    <div class="watch-actions">
                        <button class="btn-action btn-download" onclick="window.open('https://ridernoodleacerbity.com/pu4v8n14t?key=280fea026bf240b90dd4b3343468c40f', '_blank')">‚¨á Download HD</button>
                        <button class="btn-action">üëç Like</button>
                        <button class="btn-action">‚Üó Share</button>
                    </div>

                    <div style="background:#1a1a1a; padding:15px; border-radius:12px; display:flex; gap:15px; align-items:center;">
                        <div class="avatar" style="background:#cc0000; color:white; display:flex; align-items:center; justify-content:center; font-weight:bold;">DR</div>
                        <div>
                            <div style="font-weight:bold; font-size:14px;">Drachin Official</div>
                            <div style="font-size:12px; color:#aaa;">1.2M Subscribers</div>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="ad-box">Sponsored Ad</div>
                    <div id="sideGrid" style="display:flex; flex-direction:column; gap:12px;"></div>
                </div>
            </div>
        </div>

    </div>

    <script>
        const DATABASE_URL = "videos.txt";

        // Variabel UI
        const galleryView = document.getElementById('galleryView');
        const playerView = document.getElementById('playerView');
        const gridTarget = document.getElementById('gridTarget');
        const sideGrid = document.getElementById('sideGrid');
        const playerShell = document.getElementById('playerShell');
        const iframePlayer = document.getElementById('iframePlayer');
        const videoPlayer = document.getElementById('videoPlayer');
        const vidTitleLabel = document.getElementById('vidTitle');
        const statusMsg = document.getElementById('statusMsg');

        // Cek URL Params
        const urlParams = new URLSearchParams(window.location.search);
        const currentVideoId = urlParams.get('id');

        async function initApp() {
            try {
                // Tambahkan timestamp agar tidak di-cache browser (mengatasi masalah file txt tidak update)
                const res = await fetch(DATABASE_URL + '?t=' + Date.now());
                if (!res.ok) throw new Error("Gagal load videos.txt");
                const text = await res.text();
                
                const allVideos = text.split('\n')
                    .filter(line => line.includes('|'))
                    .map(line => {
                        const parts = line.split('|');
                        return { id: parts[0].trim(), title: parts[1].trim() };
                    });

                if (allVideos.length === 0) {
                    statusMsg.innerText = "Tidak ada video di videos.txt";
                    return;
                }
                statusMsg.style.display = 'none';

                if (currentVideoId) {
                    showPlayer(currentVideoId, allVideos);
                } else {
                    showGallery(allVideos);
                }

            } catch (err) {
                console.error(err);
                statusMsg.innerHTML = "Error: Pastikan file <b>videos.txt</b> sudah ada di Cloudflare.";
            }
        }

        // --- LOGIKA UTAMA: MENDETEKSI TIPE VIDEO ---
        function detectType(id) {
            // 1. Jika HTTP -> LINK LUAR
            if (id.startsWith('http')) return 'WEB';
            
            // 2. Jika ID dimulai huruf 'x' atau 'k' (Khas Dailymotion) -> DAILYMOTION
            //    ATAU jika ID-nya panjang (lebih dari 9 karakter, jaga-jaga)
            if (id.startsWith('x') || id.startsWith('k') || id.length > 9) return 'DM';
            
            // 3. Sisanya (Angka/Huruf acak pendek 8-9 digit) -> VIDEY
            return 'VIDEY';
        }

        function getThumbnail(id) {
            const type = detectType(id);
            if(type === 'WEB') return 'https://via.placeholder.com/640x360/000/fff?text=MOVIE';
            if(type === 'DM') return `https://www.dailymotion.com/thumbnail/video/${id}`;
            if(type === 'VIDEY') return 'https://via.placeholder.com/640x360/000/fff?text=PLAY+VIDEO'; // Videy susah dapat thumb
            return '';
        }

        function showGallery(videos) {
            galleryView.style.display = 'block';
            playerView.style.display = 'none';

            let html = '';
            videos.forEach(vid => {
                const thumb = getThumbnail(vid.id);
                // Kita gunakan event listener 'onerror' langsung di gambar
                // Jika gambar Dailymotion gagal load, ganti ke gambar cadangan
                const fallback = "this.src='https://via.placeholder.com/640x360/333/fff?text=Drachin'";

                html += `
                <a href="?id=${encodeURIComponent(vid.id)}" class="video-card">
                    <div class="thumb-box">
                        <img src="${thumb}" onerror="${fallback}" class="thumb-img" loading="lazy">
                        <div class="duration">HD</div>
                    </div>
                    <div class="vid-info">
                        <div class="avatar"><div style="width:100%;height:100%;background:#555;"></div></div>
                        <div class="meta-text">
                            <div class="vid-title">${vid.title}</div>
                            <div class="vid-chan">Drachin Official</div>
                        </div>
                    </div>
                </a>
                `;
            });
            gridTarget.innerHTML = html;
        }

        function showPlayer(idRaw, allVideos) {
            galleryView.style.display = 'none';
            playerView.style.display = 'block';

            const id = decodeURIComponent(idRaw);
            const foundVid = allVideos.find(v => v.id === id);
            const title = foundVid ? foundVid.title : "Menonton Video";
            
            vidTitleLabel.innerText = title;
            document.title = title;

            // Reset Player
            iframePlayer.style.display = 'none';
            iframePlayer.src = "";
            videoPlayer.style.display = 'none';
            videoPlayer.pause();
            playerShell.classList.remove('vertical');

            const type = detectType(id);
            console.log("Tipe Video Terdeteksi:", type, "ID:", id);

            // --- EKSEKUSI PEMUTARAN ---
            if (type === 'WEB') {
                if (id.match(/\.(mp4|webm|m3u8)$/i)) {
                    // Jika Link MP4 Langsung
                    videoPlayer.style.display = 'block';
                    videoPlayer.src = id;
                    videoPlayer.play();
                } else {
                    // Jika Link Embed Website Lain
                    iframePlayer.style.display = 'block';
                    iframePlayer.src = id;
                }
            } 
            else if (type === 'DM') {
                // DAILYMOTION
                iframePlayer.style.display = 'block';
                // Gunakan format embed Dailymotion yang benar
                iframePlayer.src = `https://www.dailymotion.com/embed/video/${id}?autoplay=1&ui-logo=0&queue-enable=false`;
            } 
            else {
                // VIDEY
                videoPlayer.style.display = 'block';
                videoPlayer.src = `https://cdn.videy.co/${id}.mp4`;
                videoPlayer.play();
            }

            // Handler untuk video vertikal (TikTok style)
            videoPlayer.onloadedmetadata = function() {
                if (this.videoHeight > this.videoWidth) {
                    playerShell.classList.add('vertical');
                }
            };

            // Render Sidebar
            const sideList = allVideos.filter(v => v.id !== id).slice(0, 10);
            let sideHtml = '';
            sideList.forEach(vid => {
                 const thumb = getThumbnail(vid.id);
                 const fallback = "this.src='https://via.placeholder.com/640x360/333/fff?text=Video'";
                 sideHtml += `
                 <a href="?id=${encodeURIComponent(vid.id)}" style="display:flex; gap:10px; text-decoration:none; color:white;">
                    <div style="width:140px; aspect-ratio:16/9; background:#222; border-radius:8px; overflow:hidden; flex-shrink:0;">
                        <img src="${thumb}" onerror="${fallback}" style="width:100%; height:100%; object-fit:cover;">
                    </div>
                    <div style="flex:1;">
                        <div style="font-size:13px; font-weight:600; line-height:1.2; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow
